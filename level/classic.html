<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="user-scalable=no, initial-scale=1.0" />
<title>초친 포럼 (레벨 - 클래식)</title>

<style>
/* --- 기본 설정 --- */
html, body {
  height: 100%;
  margin: 0;
  background: #323232;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}
* { box-sizing: border-box; }

/* [수정] 모든 링크의 파란색 밑줄 제거 */
a {
  color: inherit;
  text-decoration: none;
}

/* 폰트 설정 */
@font-face { font-family: Paperlogy1; src: url('font - paperlogy/Paperlogy-1.ttf'); }
@font-face { font-family: Paperlogy2; src: url('font - paperlogy/Paperlogy-2.ttf'); }
@font-face { font-family: Paperlogy3; src: url('font - paperlogy/Paperlogy-3.ttf'); }
@font-face { font-family: Paperlogy4; src: url('font - paperlogy/Paperlogy-4.ttf'); }
@font-face { font-family: Paperlogy5; src: url('font - paperlogy/Paperlogy-5.ttf'); }
@font-face { font-family: Paperlogy6; src: url('font - paperlogy/Paperlogy-6.ttf'); }
@font-face { font-family: Paperlogy7; src: url('font - paperlogy/Paperlogy-7.ttf'); }
@font-face { font-family: Paperlogy8; src: url('font - paperlogy/Paperlogy-8.ttf'); }
@font-face { font-family: Paperlogy9; src: url('font - paperlogy/Paperlogy-9.ttf'); }

/* --- 계정 바 (Mappack 스타일) --- */
.auth-bar {
  background: #202020;
  padding: 10px 20px;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 15px;
  border-bottom: 2px solid #444;
}
.user-status { color: #4f9; font-family: Paperlogy5; font-size: 0.95rem; }
.auth-btn {
  background: transparent; border: 1.5px solid #fff; color: #fff; padding: 5px 15px; border-radius: 5px;
  font-family: Paperlogy7; cursor: pointer; transition: 0.2s;
}
.auth-btn:hover { background: #fff; color: #000; }

/* --- 헤더 --- */
.header-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 5vw;
  padding: 2vh 0;
  flex-wrap: wrap;
}
.header-btn-wrapper {
  width: min(400px, 90vw);
  display: flex;
  justify-content: center;
}
.header-btn {
  background-color: #323232;
  color: white;
  font-size: clamp(1.5rem, 4vw, 3rem);
  cursor: pointer;
  padding: 1.5vh 0;
  border: none;
  border-radius: 10px;
  width: 100%;
  transition: 0.25s;
  font-family: Paperlogy5;
}
.header-btn:hover, .header-btn.active {
  background-color: #fff;
  color: #323232;
}
.divider {
  border: 2px solid white;
  width: 100%;
  height: 0;
  margin: 6px 0;
}

/* --- 메인 레이아웃 --- */
.main-container {
  display: flex;
  gap: 20px;
  padding: 20px;
  min-height: 800px;
}
.container, .detail-panel {
  background: #404040;
  border-radius: 10px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.container { flex: 1; }
.detail-panel { flex: 2; background: #505050; overflow-y: auto; }
.detail-panel.clears-panel { flex: 1; background: #404040; }

/* --- [핵심] Pointercrate 스타일 변경 이력 CSS --- */
.history-panel {
  width: calc(100% - 40px);
  margin: 20px auto 40px auto;
  background: #252525;
  border-radius: 12px;
  padding: 30px;
  border: 1px solid #444;
}
.history-title {
  font-family: Paperlogy9;
  font-size: 2.5rem;
  color: #fff;
  text-align: center;
  margin-bottom: 30px;
  border-bottom: 2px solid #555;
  padding-bottom: 15px;
}
.history-item {
  display: flex;
  align-items: center;
  padding: 15px;
  background: #333;
  margin-bottom: 10px;
  border-radius: 8px;
  border-left: 5px solid #888;
  gap: 20px;
}
.history-item.add { border-left-color: #2ecc71; }
.history-item.move { border-left-color: #3498db; }
.history-item.remove { border-left-color: #e74c3c; }
.history-item.info { border-left-color: #f1c40f; }

.history-date { font-family: Paperlogy3; color: #aaa; font-size: 0.9rem; min-width: 100px; }
.history-tag {
  padding: 4px 10px; border-radius: 4px; font-family: Paperlogy7; font-size: 0.8rem;
  text-transform: uppercase; color: #fff; min-width: 80px; text-align: center;
}
.add .history-tag { background: #2ecc71; }
.move .history-tag { background: #3498db; }
.remove .history-tag { background: #e74c3c; }
.info .history-tag { background: #f1c40f; color: #000; }

.history-content { font-family: Paperlogy5; color: #eee; font-size: 1.1rem; flex: 1; }
.history-content b { color: #fff; font-family: Paperlogy7; }

/* 리스트 아이템 스타일 */
.item {
  display: flex;
  align-items: flex-start;
  padding: 15px;
  gap: 15px;
  border-bottom: 1px solid #777;
  cursor: pointer;
  transition: 0.2s;
}
.item:hover, .item.active { background: #fff; color: #000; }
.item.cleared { background-color: #2e4a2e !important; border-left: 6px solid #4f9; }
.rank { font-family: Paperlogy9; font-size: 2.5rem; min-width: 60px; color: #fff; }
.item:hover .rank, .item.active .rank { color: #000; }
.title { font-family: Paperlogy7; font-size: 1.8rem; color: #fff; }
.item:hover .title, .item.active .title { color: #000; }
.creator { font-family: Paperlogy4; font-size: 0.9rem; color: #ccc; }

/* 비디오 래퍼 */
.video-wrapper {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
  background: #000;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 20px;
}
.video-wrapper iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: none;
}

/* 개발자 패널 */
#devPanel {
  position: fixed; top: 0; right: -400px; width: 400px; height: 100%;
  background: #222; color: white; transition: 0.3s; z-index: 1000;
  padding: 20px; overflow-y: auto; border-left: 2px solid #555;
  font-family: Paperlogy5;
}
#devPanel.open { right: 0; }
.dev-input { width: 100%; padding: 8px; margin: 5px 0; background: #333; color: white; border: 1px solid #555; border-radius: 4px; }
.dev-btn { width: 100%; padding: 10px; background: #555; border: none; color: white; border-radius: 5px; cursor: pointer; margin-top: 10px; }
.dev-btn:hover { background: #777; }
</style>
</head>

<body>

<div class="auth-bar">
  <div id="userStatus" class="user-status"></div>
  <button class="auth-btn" onclick="login()">계정 선택</button>
</div>

<div class="header-container">
  <a href="../index.html" class="header-btn-wrapper"><button class="header-btn">홈</button></a>
  <button class="header-btn active">레벨</button>
  <a href="../mappack.html" class="header-btn-wrapper"><button class="header-btn">맵 팩</button></a>
  <button class="header-btn">하디스트</button>
</div>

<div class="divider"></div>

<div id="detailHeader" style="text-align: center; margin: 40px 0;">
  <div style="font-family: Paperlogy9; font-size: 6rem; color: #fff;">Classic</div>
  <div style="color: #aaa; font-family: Paperlogy3; font-size: 1.5rem;">초친 멤버들이 만든 20초 이상의 레벨들</div>
</div>

<div class="main-container">
  <div class="container">
    <input id="search" placeholder="제목 또는 태그 검색..." oninput="updateFilter()" 
           style="width:100%; padding:12px; border-radius:8px; border:none; margin-bottom:15px; background:#333; color:white; font-family:Paperlogy5;"/>
    <div id="list" style="overflow-y:auto; flex:1;"></div>
  </div>

  <div class="detail-panel" id="detailPanel"></div>

  <div class="detail-panel clears-panel">
    <div style="font-family:Paperlogy9; font-size:2.5rem; text-align:center; color:#fff; margin-bottom:20px;">기록 명단</div>
    <div id="detailClears"></div>
  </div>
</div>

<div class="history-panel">
  <div class="history-title">CHANGELOG</div>
  <div id="historyList"></div>
</div>

<div id="devPanel">
  <h2 style="font-family:Paperlogy9;">Developer Panel</h2>
  <div id="devContent"></div>
  <button class="dev-btn" style="background:#d9534f;" onclick="exportJson()">JSON 내보내기</button>
  <button class="dev-btn" onclick="document.getElementById('devPanel').classList.remove('open')">닫기</button>
</div>

<script>
const DEV_PASSWORD = "123"; // 임시 비밀번호
let demonData = [];
let changeHistory = [];
let filteredData = [];
let currentUser = localStorage.getItem('currentUser') || null;

window.onload = function() {
  fetch('classic.json')
    .then(r => r.json())
    .then(j => {
      demonData = j.levels || [];
      changeHistory = j.history || [];
      filteredData = [...demonData];
      
      if(currentUser) document.getElementById('userStatus').innerText = `접속 계정: ${currentUser}`;
      
      generateList(filteredData);
      renderHistory();
      if (filteredData.length > 0) showDetail(filteredData[0]);
    })
    .catch(err => console.error("데이터 로드 실패:", err));
};

function login() {
  const name = prompt("본인의 닉네임을 입력해줘:");
  if (!name) return;
  currentUser = name;
  localStorage.setItem('currentUser', name);
  document.getElementById('userStatus').innerText = `접속 계정: ${name}`;
  generateList(filteredData);
}

function checkIfCleared(item) {
  if (!currentUser) return false;
  const name = currentUser.toLowerCase();
  return (item.clears && item.clears.some(c => c.player.toLowerCase() === name)) || 
         (item.verifier && item.verifier.toLowerCase() === name);
}

function generateList(data) {
  const list = document.getElementById('list');
  list.innerHTML = '';
  data.forEach(item => {
    const isDone = checkIfCleared(item);
    const div = document.createElement('div');
    div.className = `item ${isDone ? 'cleared' : ''}`;
    div.innerHTML = `
      <div class="rank">${item.id}</div>
      <div style="flex:1;">
        <div class="title">${item.title} ${isDone ? '✅' : ''}</div>
        <div class="creator">by ${item.creator}</div>
      </div>
    `;
    div.onclick = () => showDetail(item, div);
    list.appendChild(div);
  });
}

function showDetail(item, el) {
  document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
  if(el) el.classList.add('active');

  const panel = document.getElementById('detailPanel');
  panel.innerHTML = `
    <div style="text-align:center; margin-bottom:20px;">
      <div style="font-family:Paperlogy9; font-size:3rem; color:#fff;">${item.title}</div>
      <div style="color:#ccc; font-family:Paperlogy4;">by ${item.creator}</div>
    </div>
    <div class="video-wrapper">
      <iframe src="${item.video}" allowfullscreen></iframe>
    </div>
    <div style="background:#444; padding:20px; border-radius:10px; color:#ddd; font-family:Paperlogy3;">
      <p>ID: ${item.map?.mapId || '-'}</p>
      <p>오브젝트: ${item.map?.objects?.toLocaleString() || '0'}</p>
      <div style="margin-top:10px;">
        ${item.tags?.map(t => `<span style="background:#666; padding:4px 8px; border-radius:5px; margin-right:5px; font-size:0.8rem;">#${t}</span>`).join('')}
      </div>
    </div>
  `;

  const clearBox = document.getElementById('detailClears');
  clearBox.innerHTML = item.clears?.length > 0 ? 
    item.clears.map(c => `<div style="padding:10px; border-bottom:1px solid #555; color:#fff;">${c.player} (${c.percent}%)</div>`).join('') :
    '<div style="text-align:center; padding:20px; color:#888;">기록이 없습니다.</div>';
}

/* --- [핵심] Pointercrate 스타일 변경 이력 렌더링 --- */
function renderHistory() {
  const list = document.getElementById('historyList');
  if(!list) return;
  list.innerHTML = '';

  changeHistory.forEach(h => {
    let typeClass = 'info';
    let typeLabel = 'INFO';
    if (h.type === 'add') { typeClass = 'add'; typeLabel = 'ADDED'; }
    else if (h.type === 'move' || h.type === 'rank-change') { typeClass = 'move'; typeLabel = 'MOVED'; }
    else if (h.type === 'remove') { typeClass = 'remove'; typeLabel = 'REMOVED'; }

    const item = document.createElement('div');
    item.className = `history-item ${typeClass}`;
    item.innerHTML = `
      <div class="history-date">${h.time ? h.time.split(' ')[0] : '2025-01-01'}</div>
      <div class="history-tag">${typeLabel}</div>
      <div class="history-content"><b>${h.title || ''}</b> ${h.detail || ''}</div>
    `;
    list.appendChild(item);
  });
}

function updateFilter() {
  const term = document.getElementById('search').value.toLowerCase();
  filteredData = demonData.filter(d => 
    d.title.toLowerCase().includes(term) || 
    d.tags?.some(t => t.toLowerCase().includes(term))
  );
  generateList(filteredData);
}

/* 개발자 로직 (전체 유지) */
document.addEventListener('keydown', e => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'e') {
    const panel = document.getElementById('devPanel');
    if (panel.classList.contains('open')) panel.classList.remove('open');
    else if (prompt('개발자 비밀번호') === DEV_PASSWORD) {
      panel.classList.add('open');
      renderDevHome();
    }
  }
});

function renderDevHome() {
  document.getElementById('devContent').innerHTML = `
    <button class="dev-btn" onclick="renderAddLevel()">새 레벨 추가</button>
    <button class="dev-btn" onclick="alert('데이터가 브라우저에 임시 저장됩니다. 최종 제출은 JSON 내보내기를 사용하세요.')">도움말</button>
  `;
}

function renderAddLevel() {
  document.getElementById('devContent').innerHTML = `
    <h3>레벨 추가</h3>
    <input id="newTitle" class="dev-input" placeholder="레벨명">
    <input id="newCreator" class="dev-input" placeholder="제작자">
    <input id="newVideo" class="dev-input" placeholder="영상 URL">
    <input id="newID" class="dev-input" placeholder="게임 내 ID">
    <button class="dev-btn" onclick="saveNewLevel()">저장</button>
    <button class="dev-btn" onclick="renderDevHome()">뒤로가기</button>
  `;
}

function saveNewLevel() {
  const title = document.getElementById('newTitle').value;
  const creator = document.getElementById('newCreator').value;
  if(!title || !creator) return alert('필수 항목을 채워줘!');
  
  const newLv = {
    id: demonData.length + 1,
    title, creator,
    video: document.getElementById('newVideo').value,
    map: { mapId: document.getElementById('newID').value, objects: 0 },
    clears: [], tags: []
  };
  demonData.push(newLv);
  addHistory('add', title, '리스트에 추가됨');
  renderHistory();
  generateList(demonData);
  alert('추가 성공!');
  renderDevHome();
}

function addHistory(type, title, detail) {
  const d = new Date();
  const timeStr = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
  changeHistory.unshift({ time: timeStr, type, title, detail });
}

function exportJson() {
  const data = { levels: demonData, history: changeHistory };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'classic.json';
  a.click();
}
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="user-scalable=no, initial-scale=1.0" />
<title>초친 포럼 (맵 팩)</title>

<style>
/* --- 기본 설정 --- */
html, body {
  height: 100%;
  margin: 0;
  background: #323232;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}
* { box-sizing: border-box; }

/* 폰트 설정 */
@font-face { font-family: Paperlogy1; src: url('font - paperlogy/Paperlogy-1.ttf'); }
@font-face { font-family: Paperlogy2; src: url('font - paperlogy/Paperlogy-2.ttf'); }
@font-face { font-family: Paperlogy3; src: url('font - paperlogy/Paperlogy-3.ttf'); }
@font-face { font-family: Paperlogy4; src: url('font - paperlogy/Paperlogy-4.ttf'); }
@font-face { font-family: Paperlogy5; src: url('font - paperlogy/Paperlogy-5.ttf'); }
@font-face { font-family: Paperlogy6; src: url('font - paperlogy/Paperlogy-6.ttf'); }
@font-face { font-family: Paperlogy7; src: url('font - paperlogy/Paperlogy-7.ttf'); }
@font-face { font-family: Paperlogy8; src: url('font - paperlogy/Paperlogy-8.ttf'); }
@font-face { font-family: Paperlogy9; src: url('font - paperlogy/Paperlogy-9.ttf'); }

h1 { font-family: Paperlogy7; color: white; font-size: 170px; text-align: center; }
a { color: inherit; text-decoration: none; }

/* --- 헤더 영역 --- */
.header-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 5vw;
  padding: 2vh 0;
  flex-wrap: wrap;
}
.header-btn-wrapper {
  width: min(400px, 90vw);
  display: flex;
  justify-content: center;
}
.header-btn {
  background-color: #323232;
  color: white;
  font-size: clamp(1.5rem, 4vw, 3rem);
  cursor: pointer;
  padding: 1.5vh 0;
  border: none;
  border-radius: 10px;
  width: 100%;
  transition: background-color 0.25s ease, color 0.25s ease;
  font-family: Paperlogy5;
}
.header-btn:hover, .header-btn.active {
  background-color: #fff;
  color: #323232;
}
.divider {
  border: 2px solid white;
  width: 100%;
  height: 0;
  margin: 6px 0;
}

/* --- 메인 컨테이너 --- */
.main-container {
  display: flex;
  gap: 20px;
  padding: 20px;
  align-items: stretch;
  min-height: 800px;
}
  
.container,
.detail-panel {
  background: #404040;
  border-radius: 10px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* 왼쪽: 팩 리스트 */
.container {
  flex: 1;
  min-width: 0;
}

/* 중앙: 팩 상세 정보 */
.detail-panel {
  flex: 2;
  background: #505050;
  overflow-y: auto;
  min-width: 0;
}

/* 오른쪽: 올클리어 명단 */
.detail-panel.clears-panel {
  flex: 1;
  background: #404040;
}

/* 하단 히스토리 패널 */
.history-panel {
  width: calc(100% - 40px);
  margin: 0 auto 40px auto;
  background: #3a3a3a;
  border-radius: 10px;
  padding: 20px;
  min-height: 200px;
}

/* 반응형 */
@media (max-width: 1400px) {
  .main-container { flex-direction: column; }
  .container, .detail-panel, .detail-panel.clears-panel { width: 100%; margin-bottom: 20px; height: 600px; flex: none; }
}

/* --- 리스트 아이템 스타일 --- */
.item {
  display: flex;
  align-items: center;
  padding: 15px;
  gap: 15px;
  border-bottom: 1px solid #777;
  cursor: pointer;
  transition: 0.2s;
}
.item:hover, .item.active { background-color: #ffffff; }
.item:hover *, .item.active * { color: #000000 !important; }

/* [수정됨] 팩 티어 색상은 JS에서 제어하므로 기본 색상은 제거 */
.pack-tier {
  font-family: Paperlogy9;
  font-size: 1.8rem;
  min-width: 60px; /* 너비 약간 확보 */
  text-align: center;
  /* 글자 가독성을 위한 그림자 */
  text-shadow: 2px 2px 4px rgba(0,0,0,0.5); 
}
.title { font-family: Paperlogy7; font-size: 1.4rem; color: #fff; }
.creator { font-family: Paperlogy4; font-size: 0.9rem; color: #d0d0d0; }

/* --- 중앙 패널 스타일 --- */
.detail-header { text-align: center; margin-bottom: 20px; }
.pack-title { font-family: Paperlogy9; font-size: 3rem; color: #fff; margin-bottom: 5px; }
.pack-subtitle { font-family: Paperlogy4; font-size: 1.1rem; color: #aaa; }

.pack-content-box {
  background: #444;
  border-radius: 10px;
  padding: 20px;
  margin-top: 20px;
}
.content-header {
  font-family: Paperlogy6;
  font-size: 1.5rem;
  color: #fff;
  margin-bottom: 15px;
  border-bottom: 2px solid #666;
  padding-bottom: 10px;
}
.level-item {
  display: flex;
  align-items: center;
  padding: 10px;
  background: #3a3a3a;
  border-radius: 8px;
  margin-bottom: 8px;
  transition: 0.2s;
}
.level-item:hover { background: #555; }
.level-idx {
  font-family: Paperlogy7;
  font-size: 1.2rem;
  color: #aaa;
  width: 40px;
  text-align: center;
}
.level-info { flex: 1; }
.level-name { font-family: Paperlogy6; font-size: 1.1rem; color: #fff; }
.level-author { font-family: Paperlogy4; font-size: 0.85rem; color: #ccc; }
.level-link {
  padding: 6px 12px;
  background: #222;
  color: #fff;
  border-radius: 6px;
  font-size: 0.8rem;
  font-family: Paperlogy5;
  transition: 0.2s;
}
.level-link:hover { background: #fff; color: #000; }

/* 올클리어 명단 */
.clear-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 10px;
  border-bottom: 1px solid #555;
  color: #fff;
  font-family: Paperlogy5;
}
.clear-user { color: #fff; }
.clear-date { color: #aaa; font-family: Paperlogy3; font-size: 0.9rem; }

/* 상단 타이틀 */
#detailHeader { text-align: center; margin-bottom: 60px; }
#headerTitle { font-family: Paperlogy7; font-size: 120px; color: #fff; margin: 20px 0; }
#detailSubtitle { color: #aaa; font-family: Paperlogy3; font-size: 24px; }

/* 개발자 패널 */
.dev-panel {
  position: fixed; top: 0; right: -480px; width: 480px; height: 100%;
  background: #2f2f2f; box-shadow: -4px 0 16px rgba(0,0,0,0.5);
  transition: 0.3s; z-index: 9999; display: flex; flex-direction: column;
}
.dev-panel.open { right: 0; }
.dev-content { padding: 20px; overflow-y: auto; flex: 1; }
.dev-input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: none; font-family: Paperlogy5; }
.dev-label { color: #fff; margin-bottom: 5px; display: block; font-family: Paperlogy4; }
</style>
</head>

<body>

<div class="header-container">
  <a href="../index.html" class="header-btn-wrapper"><button class="header-btn">홈</button></a>
  <a href="../level.html" class="header-btn-wrapper"><button class="header-btn">레벨</button></a>
  <div class="header-btn-wrapper"><button class="header-btn active">맵 팩</button></div>
  <div class="header-btn-wrapper"><button class="header-btn">하디스트</button></div>
</div>

<div class="divider"></div>

<div id="detailHeader">
  <div id="headerTitle">Map Packs</div>
  <div id="detailSubtitle">다양한 테마와 난이도로 묶인 맵 팩에 도전하세요!</div>
</div>

<div class="main-container">
  <div class="container">
    <input id="search" placeholder="팩 검색..." style="width:100%; padding:10px; border-radius:8px; border:none;">
    <div id="packList" style="overflow-y:auto; flex:1;"></div>
  </div>

  <div class="detail-panel">
    <div id="packDetailContent">
      <div style="text-align:center; margin-top:50px; color:#888; font-family:Paperlogy5;">
        왼쪽에서 팩을 선택해주세요.
      </div>
    </div>
  </div>

  <div class="detail-panel clears-panel">
    <div style="font-family:Paperlogy9; font-size:2.5rem; text-align:center; color:white; margin-bottom:20px;">
      All Clears
    </div>
    <div id="packClears"></div>
  </div>
</div>

<div class="history-panel">
  <div style="font-family:Paperlogy9; font-size:2rem; text-align:center; color:white; margin-bottom:10px;">
    최근 변경 기록
  </div>
  <div id="historyBox"></div>
</div>

<div id="devPanel" class="dev-panel">
  <div style="padding:20px; border-bottom:1px solid #555;">
    <h2 style="color:white; font-family:Paperlogy7; margin:0;">관리자 패널</h2>
  </div>
  <div id="devContent" class="dev-content"></div>
  <button class="header-btn" onclick="exportJson()" style="margin:20px;">JSON 저장</button>
</div>

<script>
/* ================= 데이터 및 설정 ================= */
const DEV_PASSWORD = '6974';

// [핵심] 티어별 색상 설정 (원하는 색으로 수정 가능)
const TIER_COLORS = {
  "Tier 1": "#00ffff", // Cyan
  "Tier 2": "#00ff00", // Green
  "Tier 3": "#ffff00", // Yellow
  "Tier 4": "#ffaa00", // Orange
  "Tier 5": "#ff0000", // Red
  "Tier 6": "#ff00ff", // Purple
  "Unrated": "#888888" // Gray
};

let packData = [];
let changeHistory = [];

// 데이터 로드
fetch('mappack.json')
  .then(r => r.json())
  .then(j => {
    packData = j.packs || [];
    changeHistory = j.history || [];
    initPage();
  })
  .catch(() => {
    // 더미 데이터
    packData = [
      {
        id: "pack1",
        title: "Beginner Pack",
        tier: "Tier 1",
        creator: "Admin",
        description: "초보자를 위한 기초 레벨 모음입니다.",
        levels: [
          { name: "Step One", author: "User A", link: "" },
          { name: "Jump Jump", author: "User B", link: "" }
        ],
        clears: []
      }
    ];
    initPage();
  });

function initPage() {
  renderList(packData);
  renderHistory();
  if(packData.length > 0) showPackDetail(packData[0]);
}

// 리스트 렌더링 (티어 색상 적용)
function renderList(data) {
  const list = document.getElementById('packList');
  list.innerHTML = '';
  data.forEach(pack => {
    const div = document.createElement('div');
    div.className = 'item';
    
    // 티어 색상 가져오기 (없으면 흰색 기본)
    const tierColor = TIER_COLORS[pack.tier] || "#ffffff";

    div.innerHTML = `
      <div class="pack-tier" style="color: ${tierColor}">${pack.tier}</div>
      <div>
        <div class="title">${pack.title}</div>
        <div class="creator">by ${pack.creator}</div>
      </div>
    `;
    div.onclick = () => showPackDetail(pack, div);
    list.appendChild(div);
  });
}

// 상세 정보 렌더링
function showPackDetail(pack, el) {
  // 활성화 스타일
  document.querySelectorAll('.item.active').forEach(i => i.classList.remove('active'));
  if(el) el.classList.add('active');

  const tierColor = TIER_COLORS[pack.tier] || "#ffffff";

  const content = document.getElementById('packDetailContent');
  content.innerHTML = `
    <div class="detail-header">
      <div class="pack-title">${pack.title}</div>
      <div class="pack-subtitle">${pack.description}</div>
      <div style="margin-top:10px;">
        <span style="background:#333; padding:5px 12px; border-radius:15px; border: 1px solid ${tierColor}; color: ${tierColor}; font-weight:bold;">
          ${pack.tier}
        </span>
        <span style="background:#444; padding:5px 12px; border-radius:15px; margin-left:5px; color:#ddd;">
          Levels: ${pack.levels.length}
        </span>
      </div>
    </div>

    <div class="pack-content-box">
      <div class="content-header">수록곡 리스트</div>
      ${pack.levels.map((lvl, idx) => `
        <div class="level-item">
          <div class="level-idx">${idx + 1}</div>
          <div class="level-info">
            <div class="level-name">${lvl.name}</div>
            <div class="level-author">by ${lvl.author}</div>
          </div>
          ${lvl.link ? `<a href="${lvl.link}" target="_blank" class="level-link">영상 보기</a>` : ''}
        </div>
      `).join('')}
    </div>
  `;

  // 올클리어 명단 렌더링
  const clearBox = document.getElementById('packClears');
  clearBox.innerHTML = '';
  if(pack.clears && pack.clears.length > 0) {
    pack.clears.forEach(c => {
      const row = document.createElement('div');
      row.className = 'clear-row';
      row.innerHTML = `<span class="clear-user">${c.player}</span><span class="clear-date">${c.date}</span>`;
      clearBox.appendChild(row);
    });
  } else {
    clearBox.innerHTML = '<div style="text-align:center; color:#777; margin-top:20px;">아직 클리어한 유저가 없습니다.</div>';
  }
}

// 검색
document.getElementById('search').addEventListener('input', (e) => {
  const val = e.target.value.toLowerCase();
  const filtered = packData.filter(p => p.title.toLowerCase().includes(val));
  renderList(filtered);
});

/* --- 관리자 기능 --- */
document.addEventListener('keydown', e => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'e') {
    if (prompt('비밀번호') === DEV_PASSWORD) {
      document.getElementById('devPanel').classList.add('open');
      renderDevHome();
    }
  }
});

function renderDevHome() {
  const box = document.getElementById('devContent');
  box.innerHTML = `
    <button class="header-btn" onclick="renderAddPack()">팩 추가</button>
    <button class="header-btn" onclick="renderAddClear()">클리어 기록 추가</button>
    <button class="header-btn" onclick="document.getElementById('devPanel').classList.remove('open')" style="margin-top:20px;">닫기</button>
  `;
}

function renderAddPack() {
  const box = document.getElementById('devContent');
  box.innerHTML = `
    <div class="dev-label">팩 제목</div>
    <input id="p-title" class="dev-input">
    
    <div class="dev-label">티어 (예: Tier 1)</div>
    <select id="p-tier" class="dev-input">
      ${Object.keys(TIER_COLORS).map(k => `<option value="${k}">${k}</option>`).join('')}
    </select>

    <div class="dev-label">설명</div>
    <input id="p-desc" class="dev-input">
    <div class="dev-label">레벨 목록 (JSON 형식)</div>
    <textarea id="p-levels" class="dev-input" style="height:150px; background:#444; color:#fff;" placeholder='[{"name":"Lvl1", "author":"A", "link":""}]'></textarea>
    
    <button class="header-btn" onclick="submitPack()">저장</button>
    <button class="header-btn" onclick="renderDevHome()" style="margin-top:10px;">취소</button>
  `;
}

function submitPack() {
  try {
    const newPack = {
      id: "pack" + Date.now(),
      title: document.getElementById('p-title').value,
      tier: document.getElementById('p-tier').value,
      creator: "Admin",
      description: document.getElementById('p-desc').value,
      levels: JSON.parse(document.getElementById('p-levels').value),
      clears: []
    };
    packData.push(newPack);
    addHistory("팩 추가", newPack.title);
    initPage();
    alert("팩 추가 완료");
    renderDevHome();
  } catch(e) {
    alert("JSON 형식이 잘못되었습니다.");
  }
}

function renderAddClear() {
  const box = document.getElementById('devContent');
  box.innerHTML = `
    <div class="dev-label">팩 선택</div>
    <select id="c-pack" class="dev-input">
      ${packData.map((p, i) => `<option value="${i}">${p.title}</option>`).join('')}
    </select>
    <div class="dev-label">플레이어</div>
    <input id="c-player" class="dev-input">
    <div class="dev-label">날짜</div>
    <input id="c-date" class="dev-input" value="${new Date().toISOString().split('T')[0]}">
    
    <button class="header-btn" onclick="submitClear()">추가</button>
    <button class="header-btn" onclick="renderDevHome()" style="margin-top:10px;">취소</button>
  `;
}

function submitClear() {
  const idx = document.getElementById('c-pack').value;
  const player = document.getElementById('c-player').value;
  const date = document.getElementById('c-date').value;
  
  if(!player) return;
  
  packData[idx].clears.push({ player, date });
  addHistory("올클리어", `${packData[idx].title} - ${player}`);
  
  showPackDetail(packData[idx]);
  alert("기록 추가됨");
  renderDevHome();
}

/* --- 공통 기능 --- */
function addHistory(type, msg) {
  const time = new Date().toISOString().split('T')[0];
  changeHistory.unshift({ time, type, detail: msg });
  renderHistory();
}

function renderHistory() {
  const box = document.getElementById('historyBox');
  box.innerHTML = changeHistory.slice(0, 10).map(h => `
    <div style="color:#ccc; font-family:Paperlogy3; margin-bottom:5px;">
      <span style="color:#66ccff">[${h.time}]</span> <b>${h.type}</b>: ${h.detail}
    </div>
  `).join('');
}

function exportJson() {
  const data = { packs: packData, history: changeHistory };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'mappack.json';
  a.click();
}

// 자동 저장
async function saveMapPackJSON() {
  try {
    await fetch('mappack.json', {
      method: 'PUT',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ packs: packData, history: changeHistory }, null, 2)
    });
  } catch(e) {}
}
</script>
</body>
</html>

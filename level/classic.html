<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="user-scalable=no, initial-scale=1.0" />
  <title>초친 포럼 (레벨 - 클래식)</title>
  <style>
    /* --- 기초 설정 --- */
    html, body {
      height: 100%;
      margin: 0;
      background: #323232;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }
    * { box-sizing: border-box; }

    @font-face { font-family: 'Paperlogy'; src: url('font - paperlogy/Paperlogy-5.ttf'); } /* 폰트 경로는 환경에 맞게 수정 필요 */
    
    body { font-family: 'Paperlogy', sans-serif; }
    h1 { color: white; font-size: 170px; text-align: center; margin: 20px 0; }
    p, span { color: #c8c8c8; }
    a { color: inherit; text-decoration: none; }

    /* --- 헤더 --- */
    .header-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      padding: 2vh 0;
      flex-wrap: wrap;
    }
    .header-btn {
      background-color: #323232;
      color: white;
      font-size: clamp(1rem, 2vw, 1.5rem);
      cursor: pointer;
      padding: 10px 30px;
      border: 1px solid white;
      border-radius: 10px;
      transition: 0.25s;
    }
    .header-btn:hover, .header-btn.active {
      background-color: #fff;
      color: #323232;
    }
    .divider { border: 1px solid white; width: 100%; margin-bottom: 20px; }

    /* --- 메인 레이아웃 --- */
    .main-container {
      flex: 1;
      display: flex;
      gap: 20px;
      padding: 20px;
    }
    .container, .detail-panel, .clears-panel {
      background: #404040;
      border-radius: 10px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .container { flex: 1; max-width: 300px; }
    .detail-panel { flex: 2; background: #505050; overflow-y: auto; }
    .clears-panel { flex: 1; max-width: 350px; }

    /* 리스트 아이템 */
    .item {
      padding: 15px;
      border-bottom: 1px solid #666;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .item:hover, .item.active { background: #fff; color: #000; }
    .item:hover *, .item.active * { color: #000; }
    .rank { font-size: 2rem; font-weight: bold; width: 40px; }
    .title { font-size: 1.2rem; font-weight: bold; }

    /* 상세 페이지 구성 */
    .detail-header { text-align: center; margin-bottom: 20px; }
    .detail-title { font-size: 3rem; color: #fff; margin: 0; }
    .video-wrapper { position: relative; padding-top: 56.25%; margin-bottom: 20px; }
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px; }
    
    .section { background: #444; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
    .section-title { font-size: 1.2rem; color: #fff; margin-bottom: 10px; border-left: 4px solid #6fa8ff; padding-left: 10px; }
    
    /* 그래프 스타일 */
    .graph-box { margin-bottom: 15px; }
    .graph-row { display: flex; align-items: center; gap: 10px; margin: 5px 0; }
    .graph-label { width: 80px; font-size: 0.9rem; }
    .graph-bar-bg { flex: 1; background: #333; height: 12px; border-radius: 6px; overflow: hidden; }
    .graph-bar { height: 100%; background: #6fa8ff; }
    .graph-value { width: 40px; text-align: right; font-size: 0.8rem; }

    /* 태그 스타일 */
    .tag {
      display: inline-block;
      background: #666;
      padding: 4px 10px;
      border-radius: 15px;
      margin: 2px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .tag.active { background: #fff; color: #000; }

    /* 개발자 패널 */
    .dev-panel {
      position: fixed;
      top: 0; right: -500px;
      width: 450px; height: 100%;
      background: #252525;
      box-shadow: -5px 0 15px rgba(0,0,0,0.5);
      transition: 0.3s;
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
      color: white;
    }
    .dev-panel.open { right: 0; }
    .dev-input { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 4px; border: none; }
    
    @media (max-width: 1000px) {
      .main-container { flex-direction: column; }
      .container, .detail-panel, .clears-panel { max-width: 100%; }
    }
  </style>
</head>
<body>

<div class="header-container">
  <button class="header-btn" onclick="location.href='index.html'">홈</button>
  <button class="header-btn active">Classic</button>
  <button class="header-btn" onclick="location.href='challenge.html'">Challenge</button>
  <button class="header-btn" onclick="location.href='platformer.html'">Platformer</button>
</div>

<div class="divider"></div>

<div class="main-container">
  <div class="container">
    <input type="text" id="search" class="dev-input" placeholder="검색..." oninput="filterList()">
    <div id="list" style="overflow-y: auto;"></div>
  </div>

  <div class="detail-panel">
    <div class="detail-header">
      <h2 id="detailTitle" class="detail-title">레벨을 선택해줘</h2>
      <div id="detailCreator"></div>
    </div>
    <div class="video-wrapper">
      <iframe id="detailVideo" src="" allowfullscreen></iframe>
    </div>
    <div id="detailContent">
      <div id="infoSection" class="section"></div>
      <div id="graphSection" class="section"></div>
      <div id="tagSection" class="section"></div>
    </div>
  </div>

  <div class="clears-panel">
    <h3 style="text-align: center;">기록 명단</h3>
    <div id="detailClears"></div>
  </div>
</div>

<div id="devPanel" class="dev-panel">
  <h3>개발자 패널</h3>
  <hr>
  <div id="devContent">
    </div>
  <div style="margin-top: 20px; display: flex; gap: 10px;">
    <button class="header-btn" onclick="saveLevel()">저장</button>
    <button class="header-btn" onclick="closeDevPanel()">닫기</button>
  </div>
</div>

<script>
/* --- 데이터 및 상수 --- */
const TAG_GROUPS = {
  '주 게임모드': ['Cube', 'Ship', 'Ball', 'UFO', 'Wave', 'Robot', 'Spider', 'Swing'],
  '속도': ['0.5x', '1x', '2x', '3x', '4x'],
  '길이': ['Short', 'Medium', 'Long', 'XL'],
  '성격': ['Memory', 'Sync', 'Gimmick', 'Physical', 'Spam']
};

let demonData = [
  {
    id: 1,
    title: 'Test Level',
    creator: 'imBBBT',
    verifier: 'imBBBT',
    video: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
    map: { mapId: '123456', length: 'Long', objects: 12345, uploadDate: '2025-01-01' },
    song: { name: 'Test Song', artist: 'Test Artist', id: '987654' },
    gameplay: { modeRatio: { Cube: 50, Ship: 50 }, speedRatio: { '1x': 100 } },
    tags: ['Cube', '1x', 'Long'],
    clears: [{ player: 'imBBBT', percent: 100, date: '2025-01-02' }]
  }
];

let selectedDevTags = new Set();
let editingId = null;

/* --- 리스트 렌더링 --- */
function generateList(data) {
  const listEl = document.getElementById('list');
  listEl.innerHTML = '';
  data.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `<div class="rank">#${item.id}</div><div><div class="title">${item.title}</div><div class="creator">${item.creator}</div></div>`;
    div.onclick = () => showDetail(item, div);
    listEl.appendChild(div);
  });
}

function filterList() {
  const query = document.getElementById('search').value.toLowerCase();
  const filtered = demonData.filter(d => d.title.toLowerCase().includes(query) || d.creator.toLowerCase().includes(query));
  generateList(filtered);
}

/* --- 상세 정보 보기 --- */
function showDetail(item, el) {
  document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
  if(el) el.classList.add('active');

  document.getElementById('detailTitle').textContent = item.title;
  document.getElementById('detailCreator').textContent = `by ${item.creator} / Verified by ${item.verifier}`;
  document.getElementById('detailVideo').src = item.video;

  // 정보 섹션
  document.getElementById('infoSection').innerHTML = `
    <div class="section-title">정보</div>
    <p>ID: ${item.map.mapId} | 길이: ${item.map.length} | 오브젝트: ${item.map.objects.toLocaleString()}</p>
    <p>Song: ${item.song.name} - ${item.song.artist} (${item.song.id})</p>
  `;

  // 태그 섹션
  document.getElementById('tagSection').innerHTML = `<div class="section-title">태그</div>` + 
    item.tags.map(t => `<span class="tag">${t}</span>`).join('');

  // 기록 섹션
  const clearEl = document.getElementById('detailClears');
  clearEl.innerHTML = item.clears.map((c, i) => `
    <div style="padding: 5px 0; border-bottom: 1px solid #555;">
      #${i+1} <b>${c.player}</b> - ${c.percent}% (${c.date})
    </div>
  `).join('');
}

/* --- 개발자 모드 --- */
document.addEventListener('keydown', e => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'e') {
    const pw = prompt('비밀번호를 입력해');
    if (pw === '6974') openDevPanel();
  }
});

function openDevPanel(mode = 'add', id = null) {
  editingId = id;
  const panel = document.getElementById('devPanel');
  const content = document.getElementById('devContent');
  panel.classList.add('open');
  
  const data = id ? demonData.find(d => d.id === id) : null;
  selectedDevTags = data ? new Set(data.tags) : new Set();

  content.innerHTML = `
    <label>순위 (Rank)</label>
    <input id="devRank" type="number" class="dev-input" value="${data ? data.id : demonData.length + 1}">
    <label>제목</label>
    <input id="devTitle" class="dev-input" value="${data ? data.title : ''}">
    <label>제작자</label>
    <input id="devCreator" class="dev-input" value="${data ? data.creator : ''}">
    <label>검증자</label>
    <input id="devVerifier" class="dev-input" value="${data ? data.verifier : ''}">
    <label>영상 주소 (Embed)</label>
    <input id="devVideo" class="dev-input" value="${data ? data.video : ''}">
    
    <div class="section-title" style="margin-top:15px">태그 선택</div>
    <div id="devTagArea"></div>
  `;
  renderDevTags();
}

function renderDevTags() {
  const area = document.getElementById('devTagArea');
  area.innerHTML = '';
  Object.entries(TAG_GROUPS).forEach(([group, tags]) => {
    const groupDiv = document.createElement('div');
    groupDiv.innerHTML = `<div style="font-size:0.8rem; margin: 10px 0 5px;">${group}</div>`;
    tags.forEach(t => {
      const span = document.createElement('span');
      span.className = `tag ${selectedDevTags.has(t) ? 'active' : ''}`;
      span.textContent = t;
      span.onclick = () => {
        if(selectedDevTags.has(t)) selectedDevTags.delete(t);
        else selectedDevTags.add(t);
        renderDevTags();
      };
      groupDiv.appendChild(span);
    });
    area.appendChild(groupDiv);
  });
}

function saveLevel() {
  const newLevel = {
    id: parseInt(document.getElementById('devRank').value),
    title: document.getElementById('devTitle').value,
    creator: document.getElementById('devCreator').value,
    verifier: document.getElementById('devVerifier').value,
    video: document.getElementById('devVideo').value,
    tags: Array.from(selectedDevTags),
    map: { mapId: '-', length: '-', objects: 0, uploadDate: '-' },
    song: { name: '-', artist: '-', id: '-' },
    clears: []
  };

  if(editingId) {
    const idx = demonData.findIndex(d => d.id === editingId);
    demonData[idx] = newLevel;
  } else {
    demonData.push(newLevel);
  }

  // 순위 정렬
  demonData.sort((a, b) => a.id - b.id);
  // ID 재부여 (중복 방지)
  demonData.forEach((d, i) => d.id = i + 1);

  generateList(demonData);
  closeDevPanel();
  alert('저장 완료!');
}

function closeDevPanel() {
  document.getElementById('devPanel').classList.remove('open');
}

// 초기 실행
generateList(demonData);
</script>
</body>
</html>
